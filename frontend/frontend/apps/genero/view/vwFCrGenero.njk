{% extends "templates/base.html" %}

{% block content %}
  <div x-data="generoForm()">
    <ol class="breadcrumb mb-2"><li class="breadcrumb-item active">{{title}}</li></ol>
    <div class="row"><div class="col-12">
      <div class="card-header">{{title}}</div>
      <div class="card-body">
        <form>
          <div class="form-group col-md-6">
            <label for="nome">Nome do Gênero</label>
            <input type="text" class="form-control" id="nome" x-model="form.nome" required>
          </div>

          <button type="button" @click="insertForm()" class="btn btn-primary mt-4">Salvar</button>
          <a href="/genero/manutGenero" class="btn btn-info mt-4 ml-2">Retornar</a>
        </form>

        <div class="mt-3"><template x-if="message"><div :class="messageClass" x-text="message"></div></template></div>
      </div>
    </div></div>

  <script>
    function generoForm(){ return {
      form: { nome:'', removido:false },
      message:'', messageClass:'',
      async insertForm(){ try{ const res = await fetch('/genero/insertGenero',{ method:'POST', headers:{ "Content-Type":"application/json" }, body: JSON.stringify(this.form) }); const result = await res.json(); if(result.status=="ok"){ alert("Gênero cadastrado com sucesso"); this.resetForm(); } else { this.message=`Erro: ${result.status}`; this.messageClass='alert alert-danger'; } } catch(e){ this.message=`Erro de conexão: ${e.message}`; this.messageClass='alert alert-danger'; } },
      resetForm(){ this.form={ nome:'', removido:false }; this.message=false; }
    }; }
  </script>
{% endblock %}

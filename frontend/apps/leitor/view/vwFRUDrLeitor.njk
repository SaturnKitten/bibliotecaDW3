{% extends "templates/base.html" %}

{% block content %}
  <div x-data="leitorForm()">
    <ol class="breadcrumb mb-2"><li class="breadcrumb-item active">{{title}}</li></ol>
    <div class="row"><div class="col-12">
      <div class="card-header">{{tite}}</div>
      <div class="card-body">
        <form>
          <div class="form-group col-md-3">
            <label for="id">ID</label>
            <input type="text" id="id" class="form-control" x-model="form.id" x-bind:disabled="true">
          </div>
          <div class="form-group col-md-6">
            <label for="nome">Nome</label>
            <input type="text" id="nome" class="form-control" x-model="form.nome" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-6">
            <label for="email">Email</label>
            <input type="email" id="email" class="form-control" x-model="form.email" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-4">
            <label for="cpf">CPF</label>
            <input type="text" id="cpf" class="form-control" x-model="form.cpf" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-4">
            <label for="data_nascimento">Data de Nascimento</label>
            <input type="date" id="data_nascimento" class="form-control" x-model="form.data_nascimento" x-bind:disabled="disabled">
          </div>

          <button type="button" @click="updateForm()" class="btn btn-primary mt-4">Salvar</button>
          <button type="button" @click="deleteForm()" x-show="!disabled" class="btn btn-danger mt-4">Excluir</button>
          <a href="/leitor/manutLeitor" class="btn btn-info mt-4 ml-2">Retornar</a>
        </form>

        <div class="mt-3"><template x-if="message"><div :class="messageClass" x-text="message"></div></template></div>
      </div>
    </div></div>

  <script>
    function leitorForm(){ return {
      form: {
        id: "{{data.id}}",
        nome: "{{data.nome}}",
        email: "{{data.email}}",
        cpf: "{{data.cpf}}",
        data_nascimento: "{{data.data_nascimento}}",
        removido:false
      },
      message:'', messageClass:'', disabled: {{disabled}},
      async updateForm(){ try{ const res=await fetch('/leitor/updateLeitor',{ method:'POST', headers:{ "Content-Type":"application/json" }, body: JSON.stringify(this.form) }); const r=await res.json(); if(r.status=="ok"){ alert("Leitor atualizado com sucesso"); } else { this.message=`Erro: ${r.status}`; this.messageClass='alert alert-danger'; } }catch(e){ this.message=`Erro de conexão: ${e.message}`; this.messageClass='alert alert-danger'; } },
      async deleteForm(){ try{ const res=await fetch('/leitor/deleteLeitor',{ method:'POST', headers:{ "Content-Type":"application/json" }, body: JSON.stringify({ id:this.form.id }) }); const r=await res.json(); if(r.status=="ok"){ alert("Leitor removido com sucesso"); window.location.href="/leitor/manutLeitor"; } else { this.message=`Erro: ${r.status}`; this.messageClass='alert alert-danger'; } }catch(e){ this.message=`Erro de conexão: ${e.message}`; this.messageClass='alert alert-danger'; } }
    }; }
  </script>
{% endblock %}

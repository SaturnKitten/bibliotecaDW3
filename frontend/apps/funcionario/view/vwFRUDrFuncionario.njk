{% extends "templates/base.html" %}

{% block content %}
  <div x-data="funcionarioForm()">
    <ol class="breadcrumb mb-2"><li class="breadcrumb-item active">{{title}}</li></ol>
    <div class="row"><div class="col-12">
      <div class="card-header">{{tite}}</div>
      <div class="card-body">
        <form>
          <div class="form-group col-md-6">
            <label for="id">ID</label>
            <input type="text" class="form-control" id="id" x-model="form.id" x-bind:disabled="true">
          </div>
          <div class="form-group col-md-6">
            <label for="nome">Nome</label>
            <input type="text" class="form-control" id="nome" x-model="form.nome" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-6">
            <label for="username">Username</label>
            <input type="text" class="form-control" id="username" x-model="form.username" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-6">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" x-model="form.password" x-bind:disabled="disabled">
          </div>
          <div class="form-group col-md-6">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" x-model="form.email" x-bind:disabled="disabled">
          </div>

          <button type="button" @click="updateForm()" class="btn btn-primary mt-4">Salvar</button>
          <button type="button" @click="deleteForm()" x-show="!disabled" class="btn btn-danger mt-4">Excluir</button>
          <a href="/funcionario/manutFuncionario" class="btn btn-info mt-4 ml-2">Retornar</a>
        </form>

        <div class="mt-3"><template x-if="message"><div :class="messageClass" x-text="message"></div></template></div>
      </div>
    </div></div>

  <script>
    window.onload = function(){ windowOnLoad(); const localErro = "{{erro}}"; if(localErro != "") alert("[vwFuncionario|onload]Servidor retornou o erro:" + localErro); };

    function funcionarioForm(){
      return {
        form: {
          id: "{{data.id}}",
          nome: "{{data.nome}}",
          username: "{{data.username}}",
          password: "{{data.password}}",
          email: "{{data.email}}",
          removido: false
        },
        message:'', messageClass:'', disabled: {{disabled}},
        async updateForm(){
          try{
            const response = await fetch('/funcionario/updateFuncionario', { method:'POST', headers:{ "Content-Type":"application/json" }, body: JSON.stringify(this.form) });
            const result = await response.json();
            if(result.status=="ok"){ alert("Funcionário atualizado com sucesso"); } else { this.message=`Erro: ${result.status}`; this.messageClass='alert alert-danger'; }
          }catch(e){ this.message=`Erro de conexão: ${e.message}`; this.messageClass='alert alert-danger'; }
        },
        async deleteForm(){
          try{
            const response = await fetch('/funcionario/deleteFuncionario', { method:'POST', headers:{ "Content-Type":"application/json" }, body: JSON.stringify({ id: this.form.id }) });
            const result = await response.json();
            if(result.status=="ok"){ alert("Funcionário removido com sucesso"); window.location.href="/funcionario/manutFuncionario"; } else { this.message=`Erro: ${result.status}`; this.messageClass='alert alert-danger'; }
          }catch(e){ this.message=`Erro de conexão: ${e.message}`; this.messageClass='alert alert-danger'; }
        }
      };
    }
  </script>
{% endblock %}
